{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}
<h2>{{ dd }}</h2>


{% endblock content %}

{% load render_bundle from webpack_loader %}

{% block main %}
     {#    Подключение channels#}
    <script src="{% static '/channels/js/websocketbridge.js' %}" type="text/javascript"></script>
    <script>

         var text = "eeee"
        const webSocketBridge = new channels.WebSocketBridge();
        const webSocketBridgeStart = new channels.WebSocketBridge();
        const webSocketBridgeControl = new channels.WebSocketBridge();


        document.addEventListener('DOMContentLoaded', function() {
          webSocketBridge.connect('/trainsFirstConnectToGame/');
          {#webSocketBridge.listen(function(action, stream) {#}
          {#  console.log("RESPONSE:", action, stream);#}
          {#  console.log(JSON.parse(action.event.bi))#}
          {#})#}
            {#сразу конектимся#}
          {#webSocketBridge.send("hi")#}

          webSocketBridgeStart.connect('/startGameConsumer/');
          webSocketBridgeStart.listen(function(action, stream) {
             console.log("RESPONSE_notifications:", action);
          });

          webSocketBridgeControl.connect('/controlGameConsumer/');
          webSocketBridgeStart.listen(function(action, stream) {
             console.log("RESPONSE_notifications:", action);
          });


        });


         window.addEventListener(
            "keydown", downHandler, false
         );

         function downHandler(event) {
            //alert(event.keyCode)
             let whereMove = ""
             if(event.keyCode == 38){
                 whereMove = "up";
             }else if(event.keyCode == 40) {
                 whereMove = "down";
             }else if(event.keyCode == 39) {
                 whereMove = "right";
             }else if(event.keyCode == 37){
                whereMove = "left";
             }else{
                 return;
             }
             var name =   document.getElementById("player_name").value
           webSocketBridgeControl.send({"type":"moveTrainChange", "name":name, "whereMove":whereMove})
         }

         function startGame(textIn) {
            {#text = textIn + 1;#}
             console.log(textIn)
           webSocketBridgeStart.send(textIn)
        }

         function changeGame(textIn) {
            {#text = textIn + 1;#}
             console.log(textIn)
           var name =   document.getElementById("player_name").value
           webSocketBridgeControl.send({"type":textIn, "name":name})
        }
    </script>

    <input id="player_name" type="text" />Имя <br/>
    <button onclick="changeGame('join')">joinGame</button>
    <button onclick="startGame('start')">startGame</button>
    <button onclick="changeGame('play')">playGame</button>
    <button onclick="changeGame('stop')">stopGame</button>

    {# {% render_bundle 'Pixi' %}#}
    <script src="{% static 'lib/pixi.min480.js' %}"></script>




    <script type="text/javascript">
        treasHuntJs = "{% static 'images/treasureHunter.json' %}"
        arrows = "{% static 'images/arrows-res.jpg' %}"
        animalsJs = "{% static 'images/animals.json' %}"
        catImg = "{% static 'images/cat.png' %}"
        tileset = "{% static 'images/tileset.png' %}"
    </script>



{% render_bundle 'vendors' %}
{% render_bundle 'Train' %}



{% endblock main %}